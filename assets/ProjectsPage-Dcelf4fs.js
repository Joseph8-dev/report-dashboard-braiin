import{d as F,e as U,W as se,i as r,a1 as L,y as V,a2 as le,f as i,F as z,D as N,V as A,j as s,x as R,l as p,z as k,m as P,u as l,a3 as G,K as ne,s as q,c as H,T as re,U as I,v as B,p as W,X as ie,_ as K,a4 as de,r as h,w as ue,P as ce,R as pe,H as me,O as ge,a5 as ve}from"./index-CgnmhwQn.js";import{u as fe}from"./useModal-B9sBtQzG.js";import{u as ye}from"./useToast-C07KTQJD.js";import{u as E,d as _e,_ as X,c as be,e as je,a as Ve,f as we}from"./useProjects-CZ0Br1uq.js";const M=F({__name:"ProjectStatusBadge",props:{status:{type:String,required:!0}},setup(g){const v={"in progress":"primary",archived:"secondary",completed:"success",important:"warning"};return(c,y)=>{const _=se;return r(),U(_,{square:"",color:v[c.$props.status],text:c.$props.status.toUpperCase()},null,8,["color","text"])}}}),ke={class:"text-[var(--va-secondary)]"},xe={class:"flex flex-col items-center gap-4 grow"},$e={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},Ce={key:0},Pe={class:"flex justify-between"},Be={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},Ue=F({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(g){const{getUserById:v,getTeamOptions:c}=L("ProjectsPage");return(y,_)=>{const n=G,x=ne,f=q,m=R,$=A,d=le;return g.projects.length>0||g.loading?(r(),U(d,{key:0,loading:g.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:i(()=>[(r(!0),V(z,null,N(g.projects,e=>(r(),U($,{key:e.project_name,style:{"--va-card-outlined-border":"1px solid var(--va-background-element)"},outlined:""},{default:i(()=>[s(m,{class:"flex flex-col h-full"},{default:i(()=>[p("div",ke,k(new Date(e.created_at).toLocaleDateString()),1),p("div",xe,[p("h4",$e,k(e.project_name),1),p("p",null,[_[0]||(_[0]=p("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1)),l(v)(e.project_owner)?(r(),V("span",Ce,k(l(v)(e.project_owner).fullname),1)):P("",!0)]),s(n,{class:"my-4",options:l(c)(e.team),max:5},null,8,["options"]),s(M,{status:e.status},null,8,["status"])]),s(x,{class:"my-6"}),p("div",Pe,[s(f,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:o=>y.$emit("edit",e)},null,8,["onClick"]),s(f,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:o=>y.$emit("delete",e)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])):(r(),V("div",Be,"No projects"))}}}),Se={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},De={key:0,class:"flex items-center gap-2 ellipsis max-w-[230px]"},Te={class:"flex gap-2 justify-end"},he={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},Fe={key:0,class:"flex"},Oe=F({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:String,default:void 0},sortingOrder:{type:String,default:void 0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(g,{emit:v}){const c=_e([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"created_at",sortable:!0},{label:" ",key:"actions"}]),y=g,_=v,n=E(y,"sortBy",_),x=E(y,"sortingOrder",_),f=H(()=>Math.ceil(y.pagination.total/y.pagination.perPage)),{getUserById:m,getTeamOptions:$}=L("ProjectsPage");return(d,e)=>{const o=G,b=q,C=re,T=W,S=ie;return r(),V("div",null,[s(C,{"sort-by":l(n),"onUpdate:sortBy":e[0]||(e[0]=a=>I(n)?n.value=a:null),"sorting-order":l(x),"onUpdate:sortingOrder":e[1]||(e[1]=a=>I(x)?x.value=a:null),items:g.projects,columns:l(c),loading:g.loading},{"cell(project_name)":i(({rowData:a})=>[p("div",Se,k(a.project_name),1)]),"cell(project_owner)":i(({rowData:a})=>[l(m)(a.project_owner)?(r(),V("div",De,[s(X,{user:l(m)(a.project_owner),size:"small"},null,8,["user"]),B(" "+k(l(m)(a.project_owner).fullname),1)])):P("",!0)]),"cell(team)":i(({rowData:a})=>[s(o,{size:"small",options:l($)(a.team),max:5},null,8,["options"])]),"cell(status)":i(({rowData:a})=>[s(M,{status:a.status},null,8,["status"])]),"cell(created_at)":i(({rowData:a})=>[B(k(new Date(a.created_at).toLocaleDateString()),1)]),"cell(actions)":i(({rowData:a})=>[p("div",Te,[s(b,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:t=>d.$emit("edit",a)},null,8,["onClick"]),s(b,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:t=>d.$emit("delete",a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),p("div",he,[p("div",null,[p("b",null,k(d.$props.pagination.total)+" results.",1),e[6]||(e[6]=B(" Results per page ",-1)),s(T,{modelValue:d.$props.pagination.perPage,"onUpdate:modelValue":e[2]||(e[2]=a=>d.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),f.value>1?(r(),V("div",Fe,[s(b,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:d.$props.pagination.page===1,onClick:e[3]||(e[3]=a=>d.$props.pagination.page--)},null,8,["disabled"]),s(b,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:d.$props.pagination.page===f.value,onClick:e[4]||(e[4]=a=>d.$props.pagination.page++)},null,8,["disabled"]),s(S,{modelValue:d.$props.pagination.page,"onUpdate:modelValue":e[5]||(e[5]=a=>d.$props.pagination.page=a),"buttons-preset":"secondary",pages:f.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):P("",!0)])])}}}),Ie=K(Oe,[["__scopeId","data-v-b93c3aed"]]),qe={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},ze=F({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(g,{expose:v}){const c=g,y=de(),_={project_name:"",project_owner:void 0,team:[],status:void 0},n=h({..._}),x=H(()=>Object.keys(n.value).some(e=>{var o;return e==="team"?!1:n.value[e]!==((o=c.project??_)==null?void 0:o[e])}));v({isFormHasUnsavedChanges:x});const f=be();ue(()=>c.project,()=>{c.project&&(n.value={...c.project,project_owner:c.project.project_owner})},{immediate:!0});const m=e=>!!e||"This field is required",$=h(""),d=h("");return(e,o)=>{const b=ce,C=W,T=q,S=pe;return r(),U(S,{class:"flex flex-col gap-2"},{default:i(({validate:a})=>[s(b,{modelValue:n.value.project_name,"onUpdate:modelValue":o[0]||(o[0]=t=>n.value.project_name=t),label:"Project name",rules:[m]},null,8,["modelValue","rules"]),s(C,{modelValue:n.value.project_owner,"onUpdate:modelValue":o[1]||(o[1]=t=>n.value.project_owner=t),search:$.value,"onUpdate:search":o[2]||(o[2]=t=>$.value=t),searchable:"",label:"Owner","text-by":"fullname","track-by":"id","value-by":"id",rules:[m],options:l(f).items},{content:i(({value:t})=>[t?(r(),V("div",{key:t.id,class:"flex items-center gap-1 mr-4"},[P("",!0),B(" "+k(t.fullname),1)])):P("",!0)]),_:1},8,["modelValue","search","rules","options"]),s(C,{modelValue:n.value.team,"onUpdate:modelValue":o[3]||(o[3]=t=>n.value.team=t),search:d.value,"onUpdate:search":o[4]||(o[4]=t=>d.value=t),label:"Team","text-by":"fullname","track-by":"id","value-by":"id",multiple:"",rules:[t=>"length"in t&&t.length>0||"This field is required"],options:l(f).items,"max-visible-options":l(y).mdUp?3:1},{content:i(({valueArray:t})=>[t!=null&&t.length?(r(!0),V(z,{key:0},N(t,(D,O)=>(r(),V("div",{key:D.id,class:"flex items-center gap-1 mr-2"},[D?(r(),U(X,{key:0,user:D,size:"18px"},null,8,["user"])):P("",!0),B(" "+k(D.fullname)+k(O<t.length-1?",":""),1)]))),128)):P("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),s(C,{modelValue:n.value.status,"onUpdate:modelValue":o[5]||(o[5]=t=>n.value.status=t),label:"Status",rules:[m],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:i(({value:t})=>[t?(r(),U(M,{key:0,status:t.value},null,8,["status"])):P("",!0)]),_:1},8,["modelValue","rules"]),p("div",qe,[s(T,{preset:"secondary",color:"secondary",onClick:o[6]||(o[6]=t=>e.$emit("close"))},{default:i(()=>[...o[7]||(o[7]=[B("Cancel",-1)])]),_:1}),s(T,{onClick:t=>a()&&e.$emit("save",n.value)},{default:i(()=>[B(k(g.saveButtonLabel),1)]),_:1},8,["onClick"])])]),_:1})}}}),Me=K(ze,[["__scopeId","data-v-5db6e549"]]),Ee={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Le={class:"flex flex-col md:flex-row gap-2 justify-start"},Ne={key:0,class:"va-h5 mb-4"},Ae={key:1,class:"va-h5 mb-4"},Ke=F({__name:"ProjectsPage",setup(g){const v=je("projects-view",!0),{projects:c,update:y,add:_,isLoading:n,remove:x,pagination:f,sorting:m}=Ve(),{users:$,getTeamOptions:d,getUserById:e}=we();ve("ProjectsPage",{users:$,getTeamOptions:d,getUserById:e});const o=h(null),b=h(!1),C=j=>{o.value=j,b.value=!0},T=()=>{o.value=null,b.value=!0},{init:S}=ye(),a=async j=>{b.value=!1,"id"in j?(await y(j),S({message:"Project updated",color:"success"})):(await _(j),S({message:"Project created",color:"success"}))},{confirm:t}=fe(),D=async j=>{await t({title:"Delete project",message:`Are you sure you want to delete project "${j.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await x(j),S({message:"Project deleted",color:"success"}))},O=h(),J=async j=>{O.value.isFormHasUnsavedChanges?await t({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&j():j()};return(j,u)=>{const Q=me,Y=q,Z=R,ee=ge,te=A;return r(),V(z,null,[u[6]||(u[6]=p("h1",{class:"page-title"},"Projects",-1)),s(te,null,{default:i(()=>[s(Z,null,{default:i(()=>[p("div",Ee,[p("div",Le,[s(Q,{modelValue:l(v),"onUpdate:modelValue":u[0]||(u[0]=w=>I(v)?v.value=w:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])]),s(Y,{icon:"add",onClick:T},{default:i(()=>[...u[5]||(u[5]=[B("Project",-1)])]),_:1})]),l(v)?(r(),U(Ue,{key:0,projects:l(c),loading:l(n),onEdit:C,onDelete:D},null,8,["projects","loading"])):(r(),U(Ie,{key:1,"sort-by":l(m).sortBy,"onUpdate:sortBy":u[1]||(u[1]=w=>l(m).sortBy=w),"sorting-order":l(m).sortingOrder,"onUpdate:sortingOrder":u[2]||(u[2]=w=>l(m).sortingOrder=w),pagination:l(f),"onUpdate:pagination":u[3]||(u[3]=w=>I(f)?f.value=w:null),projects:l(c),loading:l(n),onEdit:C,onDelete:D},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),s(ee,{modelValue:b.value,"onUpdate:modelValue":u[4]||(u[4]=w=>b.value=w),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":J},{default:i(({cancel:w,ok:oe})=>[o.value===null?(r(),V("h1",Ne,"Add project")):(r(),V("h1",Ae,"Edit project")),s(Me,{ref_key:"editFormRef",ref:O,project:o.value,"save-button-label":o.value===null?"Add":"Save",onClose:w,onSave:ae=>{a(ae),oe()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ke as default};
//# sourceMappingURL=ProjectsPage-Dcelf4fs.js.map
