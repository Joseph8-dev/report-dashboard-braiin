import{d as M,R as le,c as D,v as E,F as I,j as s,l as u,S as ae,u as r,T as z,f as d,p as N,y as j,U as se,q as C,x as L,m as W,W as oe,i as T,_ as te,r as k,w as q,e as R,X as ne,P as re,O as H,Y as ie,Z as ue,Q as de,$ as me,V as pe,N as ce,s as fe,G as ve,D as ge}from"./index-CKPAhsDS.js";import{u as G}from"./useModal-C2xjUweC.js";import{u as be}from"./useToast-B6dhqSGU.js";import{u as h,d as Ve,_ as Q,a as X,b as ye}from"./useProjects-DhXqpFvE.js";import{u as we}from"./useForm-Ct3L5_9q.js";import{v as $}from"./utils-Blx_SZM_.js";const xe={class:"flex items-center gap-2 max-w-[230px] ellipsis"},_e={class:"max-w-[120px] ellipsis"},Ue={class:"ellipsis max-w-[230px]"},je={class:"ellipsis max-w-[300px] lg:max-w-[450px]"},$e={class:"flex gap-2 justify-end"},Ce={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},ke={key:0,class:"flex"},Be=M({__name:"UsersTable",props:{users:{type:Array,required:!0},projects:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,default:null}},emits:["edit-user","delete-user","update:sortBy","update:sortingOrder"],setup(B,{emit:y}){const S=Ve([{label:"Full Name",key:"fullname",sortable:!0},{label:"Email",key:"email",sortable:!0},{label:"Username",key:"username",sortable:!0},{label:"Role",key:"role",sortable:!0},{label:"Projects",key:"projects",sortable:!0},{label:" ",key:"actions",align:"right"}]),m=B,v=y,o=le(m,"users"),x=h(m,"sortBy",v),c=h(m,"sortingOrder",v),f={admin:"danger",user:"background-element",owner:"warning"},_=D(()=>Math.ceil(m.pagination.total/m.pagination.perPage)),{confirm:b}=G(),A=async t=>{await b({title:"Delete user",message:`Are you sure you want to delete ${t.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&v("delete-user",t)},F=t=>{const a=t.reduce((l,p)=>{var V;const w=(V=m.projects)==null?void 0:V.find(({id:n})=>p===n);return w&&l.push(w.project_name),l},[]);return a.length===0?"No projects":a.length<=2?a.map(l=>l).join(", "):a.slice(0,2).map(l=>l).join(", ")+" + "+(a.length-2)+" more"};return(t,a)=>{const l=se,p=N,w=ae,V=W,n=oe;return T(),E(I,null,[s(w,{"sort-by":r(x),"onUpdate:sortBy":a[0]||(a[0]=e=>z(x)?x.value=e:null),"sorting-order":r(c),"onUpdate:sortingOrder":a[1]||(a[1]=e=>z(c)?c.value=e:null),columns:r(S),items:o.value,loading:t.$props.loading},{"cell(fullname)":d(({rowData:e})=>[u("div",xe,[s(Q,{user:e,size:"small"},null,8,["user"]),C(" "+j(e.fullname),1)])]),"cell(username)":d(({rowData:e})=>[u("div",_e,j(e.username),1)]),"cell(email)":d(({rowData:e})=>[u("div",Ue,j(e.email),1)]),"cell(role)":d(({rowData:e})=>[s(l,{text:e.role,color:f[e.role]},null,8,["text","color"])]),"cell(projects)":d(({rowData:e})=>[u("div",je,j(F(e.projects)),1)]),"cell(actions)":d(({rowData:e})=>[u("div",$e,[s(p,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:U=>t.$emit("edit-user",e)},null,8,["onClick"]),s(p,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete user",onClick:U=>A(e)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),u("div",Ce,[u("div",null,[u("b",null,j(t.$props.pagination.total)+" results.",1),a[6]||(a[6]=C(" Results per page ",-1)),s(V,{modelValue:t.$props.pagination.perPage,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$props.pagination.perPage=e),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),_.value>1?(T(),E("div",ke,[s(p,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:t.$props.pagination.page===1,onClick:a[3]||(a[3]=e=>t.$props.pagination.page--)},null,8,["disabled"]),s(p,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:t.$props.pagination.page===_.value,onClick:a[4]||(a[4]=e=>t.$props.pagination.page++)},null,8,["disabled"]),s(n,{modelValue:t.$props.pagination.page,"onUpdate:modelValue":a[5]||(a[5]=e=>t.$props.pagination.page=e),"buttons-preset":"secondary",pages:_.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):L("",!0)])],64)}}}),Se=te(Be,[["__scopeId","data-v-fddfb7f3"]]),Ae={class:"self-stretch flex-col justify-start items-start gap-4 flex"},Fe={class:"flex gap-4 flex-col sm:flex-row w-full"},Oe={class:"flex gap-4 flex-col sm:flex-row w-full"},Te={class:"flex gap-4 w-full"},Pe={class:"w-1/2"},Ee={class:"flex items-center w-1/2 mt-4"},Me={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Ne=M({__name:"EditUserForm",props:{user:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(B,{expose:y,emit:S}){const m=B,v={avatar:"",fullname:"",role:"user",username:"",notes:"",email:"",active:!0,projects:[]},o=k({...v}),x=D(()=>Object.keys(o.value).some(a=>{var l;return a==="avatar"||a==="projects"?!1:o.value[a]!==((l=m.user??v)==null?void 0:l[a])}));y({isFormHasUnsavedChanges:x});const{projects:c}=X({pagination:k({page:1,perPage:9999,total:10})});q([()=>m.user,c],()=>{m.user&&(o.value={...m.user,projects:m.user.projects.filter(a=>c.value.find(({id:l})=>l===a)),avatar:m.user.avatar||""})},{immediate:!0});const f=k(),_=a=>URL.createObjectURL(a);q(f,a=>{o.value.avatar=a?_(a):""});const b=we("add-user-form"),A=S,F=()=>{b.validate()&&A("save",o.value)},t=[{text:"Admin",value:"admin"},{text:"User",value:"user"},{text:"Owner",value:"owner"}];return(a,l)=>{const p=N,w=ne,V=H,n=W,e=ie,U=ue,O=de;return T(),R(O,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:d(({isValid:P})=>[s(w,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=i=>f.value=i),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:d(()=>[s(Q,{user:o.value,size:"large"},null,8,["user"]),s(p,{preset:"primary",size:"small"},{default:d(()=>[...l[10]||(l[10]=[C("Add image",-1)])]),_:1}),f.value?(T(),R(p,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:l[0]||(l[0]=re(i=>f.value=void 0,["stop"]))})):L("",!0)]),_:1},8,["modelValue"]),u("div",Ae,[u("div",Fe,[s(V,{modelValue:o.value.fullname,"onUpdate:modelValue":l[2]||(l[2]=i=>o.value.fullname=i),label:"Full name",class:"w-full sm:w-1/2",rules:[r($).required],name:"fullName"},null,8,["modelValue","rules"]),s(V,{modelValue:o.value.username,"onUpdate:modelValue":l[3]||(l[3]=i=>o.value.username=i),label:"Username",class:"w-full sm:w-1/2",rules:[r($).required],name:"username"},null,8,["modelValue","rules"])]),u("div",Oe,[s(V,{modelValue:o.value.email,"onUpdate:modelValue":l[4]||(l[4]=i=>o.value.email=i),label:"Email",class:"w-full sm:w-1/2",rules:[r($).required,r($).email],name:"email"},null,8,["modelValue","rules"]),s(n,{modelValue:o.value.projects,"onUpdate:modelValue":l[5]||(l[5]=i=>o.value.projects=i),label:"Projects",class:"w-full sm:w-1/2",options:r(c),"value-by":"id","text-by":"project_name",rules:[r($).required],name:"projects",multiple:"","max-visible-options":2},null,8,["modelValue","options","rules"])]),u("div",Te,[u("div",Pe,[s(n,{modelValue:o.value.role,"onUpdate:modelValue":l[6]||(l[6]=i=>o.value.role=i),label:"Role",class:"w-full",options:t,rules:[r($).required],name:"role","value-by":"value"},null,8,["modelValue","rules"])]),u("div",Ee,[s(e,{modelValue:o.value.active,"onUpdate:modelValue":l[7]||(l[7]=i=>o.value.active=i),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),s(U,{modelValue:o.value.notes,"onUpdate:modelValue":l[8]||(l[8]=i=>o.value.notes=i),label:"Notes",class:"w-full",name:"notes"},null,8,["modelValue"]),u("div",Me,[s(p,{preset:"secondary",color:"secondary",onClick:l[9]||(l[9]=i=>a.$emit("close"))},{default:d(()=>[...l[11]||(l[11]=[C("Cancel",-1)])]),_:1}),s(p,{disabled:!P,onClick:F},{default:d(()=>[C(j(B.saveButtonLabel),1)]),_:1},8,["disabled"])])])]),_:1},512)}}}),ze={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},qe={class:"flex flex-col md:flex-row gap-2 justify-start"},Re={class:"va-h5"},Ge=M({__name:"UsersPage",setup(B){const y=k(!1),{users:S,isLoading:m,filters:v,sorting:o,pagination:x,error:c,...f}=ye(),{projects:_}=X(),b=k(null),A=n=>{b.value=n,y.value=!0},F=()=>{b.value=null,y.value=!0},{init:t}=be();me(()=>{c.value&&t({message:c.value.message,color:"danger"})});const a=async n=>{if(n.avatar.startsWith("blob:")){const e=await fetch(n.avatar).then(O=>O.blob()),{publicUrl:U}=await f.uploadAvatar(e);n.avatar=U}b.value?(await f.update(n),c.value||t({message:`${n.fullname} has been updated`,color:"success"})):(await f.add(n),c.value||t({message:`${n.fullname} has been created`,color:"success"}))},l=async n=>{await f.remove(n),t({message:`${n.fullname} has been deleted`,color:"success"})},p=k(),{confirm:w}=G(),V=async n=>{p.value.isFormHasUnsavedChanges?await w({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&n():n()};return(n,e)=>{const U=ve,O=ge,P=H,i=N,Y=fe,Z=pe,J=ce;return T(),E(I,null,[e[6]||(e[6]=u("h1",{class:"page-title"},"Users",-1)),s(Z,null,{default:d(()=>[s(Y,null,{default:d(()=>[u("div",ze,[u("div",qe,[s(U,{modelValue:r(v).isActive,"onUpdate:modelValue":e[0]||(e[0]=g=>r(v).isActive=g),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),s(P,{modelValue:r(v).search,"onUpdate:modelValue":e[1]||(e[1]=g=>r(v).search=g),placeholder:"Search"},{prependInner:d(()=>[s(O,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),s(i,{onClick:F},{default:d(()=>[...e[5]||(e[5]=[C("Add User",-1)])]),_:1})]),s(Se,{"sort-by":r(o).sortBy,"onUpdate:sortBy":e[2]||(e[2]=g=>r(o).sortBy=g),"sorting-order":r(o).sortingOrder,"onUpdate:sortingOrder":e[3]||(e[3]=g=>r(o).sortingOrder=g),users:r(S),projects:r(_),loading:r(m),pagination:r(x),onEditUser:A,onDeleteUser:l},null,8,["sort-by","sorting-order","users","projects","loading","pagination"])]),_:1})]),_:1}),s(J,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=g=>y.value=g),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":V},{default:d(({cancel:g,ok:K})=>[u("h1",Re,j(b.value?"Edit user":"Add user"),1),s(Ne,{ref_key:"editFormRef",ref:p,user:b.value,"save-button-label":b.value?"Save":"Add",onClose:g,onSave:ee=>{a(ee),K()}},null,8,["user","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Ge as default};
//# sourceMappingURL=UsersPage-__C7y_qb.js.map
